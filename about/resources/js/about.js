var ConanAbout = {
    _i18n: {
        'fr': {
            'name': "Compagnon<br/>de Conan",
            'title': "Le compagnon de Conan",
            'text': "Cette application n'a aucun lien avec l'édteur du jeu Conan : Monolith.<br/>Elle a été réalisée par @cochon en s'appuyant sur les cartes statiques de lignes de vue créées par @Roolz et en reprenant l'idée du travail de @Pamplerousse pour les lignes de vues dynamiques.",
            'find': "Consultez le forum 'The Overlord'",
            'fullscreen': "Plein écran",
            'about': "A propos",
            'copyright': "Copyright",
            'copyright-text': "'Compagnion de Conan' est une application indépendante pour accompagner les joueurs dans le jeu 'Conan'.<br/>"
                    + "Cette application a été écrite par <a href='https://the-overlord.com/index.php?/profile/5240-cochon/' target='_blank'>@cochon</a>.<br/>"
                    + "<br/>"
                    + "'Conan' est un jeu de plateau de figurines édité par <a href='http://monolithedition.com' target='_blank'>Monolith</a>.<br/>"
                    + "Le logo Conan et les polices de caractères utilisées sont la propriété de Monolith.<br/>"
                    + "L'image du 'Compagnion de Conan' a été créée à partir du logo Conan.<br/>",
            'preferences': 'Mes préferences',
            'preferences_text': "Sélectionnez vos préférences qui seront enregistrées sur votre appareil.",
            'preferences_general': "Généralités",
            'custom': "Mes extensions",
            'custom_text': "Sélectionnez vos extensions qui seront enregistrés sur votre appareil.",
            'custom_box': "Boîte de jeu",
            'custom_lang': "Français",
            'custom_regionalexts': "Extensions régionales",
            'custom_otherexts': "Autres extensions",
            'custom_artists': "Extensions d'artistes",
            'custom_decoration': "Décors",
            'custom_books': "Livres",
            'custom_reload': "La modification de votre configuration entrainera un redémarage automatique de l'application"
        },
        'en': {
            'name': "Companion<br/>for Conan",
            'title': "The companion for Conan",
            'text': "This application has no link with the producer of the game Conan: Monolith.<br/>It was realized by @cochon based on the static maps of line of sights created by @Roolz and by taking up again the idea of the work of @Pamplerousse of the dynamic line of sights.",
            'find': "Consult the forum 'The Overlord'",
            'fullscreen': "Fullscreen",
            'about': "About",
            'copyright': "Copyright",
            'copyright-text': "'Companion for Conan' is an indepedant applciation to help the players in the game 'Conan'.<br/>"
                    + "This application was written by <a href='https://the-overlord.com/index.php?/profile/5240-cochon/' target='_blank'>@cochon</a>.<br/>"
                    + "<br/>"
                    + "'Conan' is a board game published by <a href='http://monolithedition.com' target='_blank'>Monolith</a>.<br/>"
                    + "The Conan logo and the fonts used are the property of Monolith.<br/>"
                    + "The image of 'Companion for Conan' was created by adapting the Conan logo.<br/>",
            'preferences': 'My preferences',
            'preferences_text': "Select your preferences that will be stored on your device.",
            'preferences_general': "Generality",
            'custom': "My expansions",
            'custom_text': "Select your expansions that will be stored on your device.",
            'custom_box': "Game box",
            'custom_lang': "English",
            'custom_regionalexts': "Regional expansions",
            'custom_otherexts': "Other expansions",
            'custom_artists': "Artists expansions",
            'custom_decoration': "Decorations",
            'custom_books': "Books",
            'custom_reload': "The modification of your configuration will require an automatic application reload"
        }
    },
    
    _origins: {
        'fr': {
            'corebox': "Boîte de base",
            'corebox-short': "Boîte de base",
            'stretchgoal': "Boîte de base étendue \"Barbarian\"",
            'stretchgoal-short': "Boîte Barbarian", 
            'king': "Boîte de base étendue \"King\"",
            'king-short': "Boîte King",
            
            'nordheim': "Extension Nordheim",
            'nordheim-short': "Nordheim",
            'khitai': "Extension Khitaï",
            'khitai-short': "Khitaï",
            'stygie': "Extension Stygie",
            'stygie-short': "Stygie",
            
            'crossbowmen': "Arbalétriers",
            'blackdragons': "Dragons Noirs",
            'blackones': "Hommes Noirs",
            'kushwitchhunters': "Chasseurs de sorcières Kushites",
            'valvan': "Valkyrie Vanir",
            'yoy': "Yogah de Yag",
            'baalpteor': "Baal-Pteor",
            'demonearth': "Démon de la Terre",
            'dragon': "Dragon",
            'giantwolves': "Loups géants",
            'sabretoothtiger': "Tigre à dents de sabre",
            
            'xcbox': "Xavier Colette Box",
            'bbox': "Brom Box",
            'ppbox': "Paolo Parente Box",

            'campaignbook': "Livre de Campagne",
            'setbook': "Livre de Set",

            'doorpack': "Pack de portes",
            'adventurepack': "Pack aventure"
        },
        'en': {
            'corebox': "Core box", 
            'corebox-short': "Core box", 
            'stretchgoal': "\"Barbarian\" expanded core box",
            'stretchgoal-short': "Barbarian box",
            'king': "King box",
            'king-short': "\"King\" expanded core box",
            
            'nordheim': "Nordheim expansion",
            'nordheim-short': "Nordheim",
            'khitai': "Khitaï expansion",
            'khitai-short': "Khitaï",
            'stygie': "Stygie expansion",
            'stygie-short': "Stygie",
            
            'crossbowmen': "Crossbowmen",
            'blackdragons': "Black dragons",
            'blackones': "Black ones",
            'kushwitchhunters': "Kushites witch-hunters",
            'valvan': "Valkyrie Vanir",
            'yoy': "Yogah of Yag",
            'baalpteor': "Baal-Pteor",
            'demonearth': "Demon of the earth",
            'dragon': "Dragon",
            'giantwolves': "Giant wolves",
            'sabretoothtiger': "Sabretooth tiger",
            
            'xcbox': "Xavier Colette Box",
            'bbox': "Brom Box",
            'ppbox': "Paolo Parente Box",

            'campaignbook': "Book campaign",
            'setbook': "Livre de Set",

            'doorpack': "Pack de portes",
            'adventurepack': "Pack aventure"
        }
    },
    
    _copyright: "",
    
    _toggleFullscreen: function() {
        $("nav.menu input")[0].checked = false;

        var elem = document.documentElement;
          if (!document.fullscreenElement) {
              document.documentElement.requestFullscreen();
          } else {
            if (document.exitFullscreen) {
              document.exitFullscreen(); 
            }
          }
    },

    init: function()
    {
        Menu.addMenu(ConanAbout._i18n[Language].fullscreen, "about-fullscreen", "ConanAbout._toggleFullscreen()");
        
        Menu.addMenu(ConanAbout._i18n[Language].custom, "about-custom", "ConanAbout._custom()", true);
        Menu.addMenu(ConanAbout._i18n[Language].preferences, "about-preferences", "ConanAbout._preferences()");
        
        Menu.addMenu(ConanAbout._i18n[Language].about, "about-about", "ConanAbout._about()", true);
    },
    
    _about: function()
    {
        $("nav.menu input")[0].checked = false;
        
        Nav.dialog(ConanAbout._i18n[Language].about,
            "<div id='about' class='about'>"
                    + "<div class='about-zone-about'>"
                            + "<img src='about/resources/img/logo.jpg'/>" +
                            "<a class='fullscreen' onclick='ConanAbout._toggleFullscreen(); return false' href='javascript:void(0);' title=\"" + ConanAbout._i18n[Language].fullscreen + "\"></a>" + 
                            "<span>" + ConanAbout._i18n[Language].text + 
                                "<div><a target='_blank' href='https://the-overlord.com/'>" + ConanAbout._i18n[Language].find + "</a></div>" +
                            "</span>"
                    + "</div>"
                    + "<div class='about-copyright'><div>"
                        + "<div class='about-copyright-text'>" + ConanAbout._i18n[Language]['copyright-text'] + ConanAbout._copyright + "</div>"
                    + "</div></div>"
                + "</div>"        
        );        
    },
    
    addCopyright: function(title, text)
    {
        ConanAbout._copyright += "<h1>" + title + "</h1>" + text + "<br/>";
    },
    
    _preferences: function()
    {
        $("nav.menu input")[0].checked = false;
        
        Nav.dialog(ConanAbout._i18n[Language].custom,
            "<div class=\"custom\">"
            +       "<div>" + ConanAbout._i18n[Language].preferences_text + "</div>"
            
            +       "<div class=\"custom-wrap\">"
            +       "<fieldset><legend>" + ConanAbout._i18n[Language].preferences_general + "</legend>"
            +           "<select id=\"custom-lang\" name=\"custom-lang\">"
            +               "<option value=\"fr\">" + ConanAbout._i18n['fr'].custom_lang + "</option>"
            +               "<option value=\"en\">" + ConanAbout._i18n['en'].custom_lang + "</option>"
            +           "</select>"
            +           "</fieldset>"
            +       "</div>"

            + "</div>",

            function() 
            {
                var oldLanguage = Language;
                
                // Save
                Language = $(".custom *[name=custom-lang]")[0].value;
                localStorage.setItem("Language", Language);
                
                if (oldLanguage != Language)
                {
                    window.location.reload(true);
                }
            }
        );

        $(".custom *[name=custom-lang]")[0].value = Language;
        
        var display = false;
        $(".custom input, .custom select").on('change', function() {
            if (!display)
            {
                $(document.body).append("<div class=\"reload\" style=\"bottom: -100px; opacity: 0;\">" + ConanAbout._i18n[Language].custom_reload + "</div>");
                window.setTimeout(function() { $(".reload").css("bottom", "30px").css("opacity", "1"); }, 1);
                window.setTimeout(function() { $(".reload").css("bottom", "-100px").css("opacity", "0"); }, 3000);
                window.setTimeout(function() { $(".reload").remove(); }, 3500);
            }
            display = true;
        })
    },
    
    _custom: function()
    {
        $("nav.menu input")[0].checked = false;
        
        Nav.dialog(ConanAbout._i18n[Language].custom,
            "<div class=\"custom\">"
            +       "<div>" + ConanAbout._i18n[Language].custom_text + "</div>"
            
            +       "<div class=\"custom-wrap\">"
            
            +       "<fieldset><legend>" + ConanAbout._i18n[Language].custom_box + "</legend>"
            +           "<select id=\"custom-box\" name=\"custom-box\">"
            +               "<option value=\"corebox\">" + ConanAbout._origins[Language].corebox + "</option>"
            +               "<option value=\"stretchgoal\">" + ConanAbout._origins[Language].stretchgoal + "</option>"
            +               "<option value=\"king\">" + ConanAbout._origins[Language].king + "</option>"
            +           "</select>"
            +       "</fieldset>"

            +       "<fieldset><legend>" + ConanAbout._i18n[Language].custom_regionalexts + "</legend>"
            +           "<div><input type=\"checkbox\" name=\"stygie\"\ id=\"stygie\"><label for=\"stygie\">" + ConanAbout._origins[Language].stygie + "</label></div>"
            +           "<div><input type=\"checkbox\" name=\"nordheim\"\ id=\"nordheim\"><label for=\"nordheim\">" + ConanAbout._origins[Language].nordheim + "</label></div>"
            +           "<div><input type=\"checkbox\" name=\"khitai\"\ id=\"khitai\"><label for=\"khitai\">" + ConanAbout._origins[Language].khitai + "</label></div>"
            +       "</fieldset>"

            +       "<fieldset><legend>" + ConanAbout._i18n[Language].custom_otherexts + "</legend>"
            +           "<div><input type=\"checkbox\" name=\"crossbowmen\"\ id=\"crossbowmen\"\><label for=\"crossbowmen\">" + ConanAbout._origins[Language].crossbowmen + "</label></div>"
            +           "<div><input type=\"checkbox\" name=\"blackdragons\"\ id=\"blackdragons\"\><label for=\"blackdragons\">" + ConanAbout._origins[Language].blackdragons + "</label></div>"
            +           "<div><input type=\"checkbox\" name=\"blackones\"\ id=\"blackones\"\><label for=\"blackones\">" + ConanAbout._origins[Language].blackones + "</label></div>"
            +           "<div><input type=\"checkbox\" name=\"kushwitchhunters\"\ id=\"kushwitchhunters\"\><label for=\"kushwitchhunters\">" + ConanAbout._origins[Language].kushwitchhunters + "</label></div>"
            +           "<div><input type=\"checkbox\" name=\"valvan\"\ id=\"valvan\"\><label for=\"valvan\">" + ConanAbout._origins[Language].valvan + "</label></div>"
            +           "<div><input type=\"checkbox\" name=\"yoy\"\ id=\"yoy\"\><label for=\"yoy\">" + ConanAbout._origins[Language].yoy + "</label></div>"
            +           "<div><input type=\"checkbox\" name=\"baalpteor\"\ id=\"baalpteor\"\><label for=\"baalpteor\">" + ConanAbout._origins[Language].baalpteor + "</label></div>"
            +           "<div><input type=\"checkbox\" name=\"demonearth\"\ id=\"demonearth\"\><label for=\"demonearth\">" + ConanAbout._origins[Language].demonearth + "</label></div>"
            +           "<div><input type=\"checkbox\" name=\"dragon\"\ id=\"dragon\"\><label for=\"dragon\">" + ConanAbout._origins[Language].dragon + "</label></div>"
            +           "<div><input type=\"checkbox\" name=\"giantwolves\"\ id=\"giantwolves\"\><label for=\"giantwolves\">" + ConanAbout._origins[Language].giantwolves + "</label></div>"
            +           "<div><input type=\"checkbox\" name=\"sabretoothtiger\"\ id=\"sabretoothtiger\"\><label for=\"sabretoothtiger\">" + ConanAbout._origins[Language].sabretoothtiger + "</label></div>"
            +       "</fieldset>"

            +       "<fieldset><legend>" + ConanAbout._i18n[Language].custom_books + "</legend>"
            +           "<div><input type=\"checkbox\" name=\"campaignbook\"\ id=\"campaignbook\"\><label for=\"campaignbook\">" + ConanAbout._origins[Language].campaignbook + "</label></div>"
            +           "<div><input type=\"checkbox\" name=\"setbook\"\ id=\"setbook\"\><label for=\"setbook\">" + ConanAbout._origins[Language].setbook + "</label></div>"
            +       "</fieldset>"

            +       "<fieldset><legend>" + ConanAbout._i18n[Language].custom_artists + "</legend>"
            +           "<div><input type=\"checkbox\" name=\"xcbox\"\ id=\"xcbox\"\><label for=\"xcbox\">" + ConanAbout._origins[Language].xcbox + "</label></div>"
            +           "<div><input type=\"checkbox\" name=\"bbox\"\ id=\"bbox\"\><label for=\"bbox\">" + ConanAbout._origins[Language].bbox + "</label></div>"
            +           "<div><input type=\"checkbox\" name=\"ppbox\"\ id=\"ppbox\"\><label for=\"ppbox\">" + ConanAbout._origins[Language].ppbox + "</label></div>"
            +       "</fieldset>"

            +       "<fieldset><legend>" + ConanAbout._i18n[Language].custom_decoration + "</legend>"
            +           "<div><input type=\"checkbox\" name=\"doorpack\"\ id=\"doorpack\"\><label for=\"doorpack\">" + ConanAbout._origins[Language].doorpack + "</label></div>"
            +           "<div><input type=\"checkbox\" name=\"adventurepack\"\ id=\"adventurepack\"\><label for=\"adventurepack\">" + ConanAbout._origins[Language].adventurepack + "</label></div>"
            +       "</fieldset>"
            
            +       "</div>"

            + "</div>",
            
            function() {
                var oldExtensions = Extensions;
                
                // Save
                Extensions = {};
                $(".custom *").each(function (i) {
                    var $this = $(this);
                    if ($this.is('select'))
                    {
                        Extensions[this.name] = this.value;
                    }
                    else if ($this.is('input'))
                    {
                        Extensions[this.name] = this.checked ? true : false;
                    }
                });

                localStorage.setItem("Extensions", JSON.stringify(Extensions));
                
                function _notEquals(a, b)
                {
                    for (var i in a)
                    {
                        if (a[i] != (b[i] || false))
                        {
                            return true;
                        }
                    }
                    for (var i in b)
                    {
                        if (b[i] != (a[i] || false))
                        {
                            return true;
                        }
                    }
                    return false;
                }
                
                if (_notEquals(oldExtensions, Extensions))
                {
                    window.location.reload(true);
                }
            }
        );
        
        for (var i in Extensions)
        {
            $(".custom *[name=" + i + "]").each(function (i) {
                var $this = $(this);
                if ($this.is('select'))
                {
                    this.value = Extensions[this.name];                    
                }
                else if ($this.is('input'))
                {
                    this.checked = Extensions[this.name];
                }
            });
        }
        
        var display = false;
        $(".custom input, .custom select").on('change', function() {
            if (!display)
            {
                $(document.body).append("<div class=\"reload\" style=\"bottom: -100px; opacity: 0;\">" + ConanAbout._i18n[Language].custom_reload + "</div>");
                window.setTimeout(function() { $(".reload").css("bottom", "30px").css("opacity", "1"); }, 1);
                window.setTimeout(function() { $(".reload").css("bottom", "-100px").css("opacity", "0"); }, 3000);
                window.setTimeout(function() { $(".reload").remove(); }, 3500);
            }
            display = true;
        })
    }
}

$(document.head).append("<title>" + ConanAbout._i18n[Language].title + "</title>");

